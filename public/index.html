<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI証拠分類ツール</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>🤖 AI証拠分類ツール</h1>
            <p>会計資料をAIで自動分類します</p>
        </header>

        <main>
            <!-- ファイルアップロードエリア -->
            <div class="upload-area" id="uploadArea">
                <div class="upload-content">
                    <div class="upload-icon">📁</div>
                    <h3>ファイルをドラッグ&ドロップ</h3>
                    <p>または</p>
                    <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                        ファイルを選択
                    </button>
                    <input type="file" id="fileInput" accept="image/*,.pdf" multiple style="display: none;">
                    <p class="file-info">対応形式: PNG, JPG, JPEG, GIF, PDF</p>
                </div>
            </div>

            <!-- 選択されたファイル表示 -->
            <div class="selected-files" id="selectedFiles" style="display: none;">
                <h3>選択されたファイル</h3>
                <div class="file-list" id="fileList"></div>
                <button class="classify-btn" id="classifyBtn" onclick="startClassification()">
                    🚀 分類開始
                </button>
            </div>

            <!-- 進捗表示 -->
            <div class="progress-area" id="progressArea" style="display: none;">
                <h3>分類中...</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="progressText">準備中...</p>
                <div class="progress-stats" id="progressStats" style="display: none;">
                    <div class="stat-item">
                        <span class="stat-label">完了:</span>
                        <span class="stat-value" id="completedCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">成功:</span>
                        <span class="stat-value success" id="successCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">エラー:</span>
                        <span class="stat-value error" id="errorCount">0</span>
                    </div>
                </div>
            </div>

            <!-- 結果表示 -->
            <div class="results-area" id="resultsArea" style="display: none;">
                <h3>分類結果</h3>
                <div class="results-list" id="resultsList"></div>
                <button class="download-btn" id="downloadBtn" onclick="downloadResults()">
                    📊 CSVダウンロード
                </button>
                <button class="reset-btn" onclick="resetApp()">
                    🔄 リセット
                </button>
            </div>

            <!-- Box連携セクション -->
            <div class="box-section" id="boxSection">
                <h3>📦 Box連携</h3>
                <p>Boxアカウントと連携して、ファイルを直接Boxから取得・分類できます</p>
                
                <!-- Box認証 -->
                <div class="auth-section">
                    <h4>Box認証</h4>
                    <div id="authStatus" class="auth-status">
                        <p>Boxにログインしてください</p>
                        <button class="auth-btn" id="authBtn" onclick="authenticateBox()">
                            🔐 Boxにログイン
                        </button>
                    </div>
                </div>

                <!-- 認証後のフォルダ設定 -->
                <div class="folder-section" id="folderSection" style="display: none;">
                    <h4>フォルダ設定</h4>
                    <div class="folder-input">
                        <label for="parentFolderInput">親フォルダID/URL:</label>
                        <input type="text" id="parentFolderInput" placeholder="https://box.com/folder/123456789 または 123456789">
                        <button onclick="setParentFolder()">設定適用</button>
                    </div>
                    
                    <div class="folder-info" id="folderInfo" style="display: none;">
                        <h5>現在の設定:</h5>
                        <p id="currentFolderName"></p>
                        <button onclick="checkRequiredFolders()">必須フォルダをチェック</button>
                    </div>
                    
                    <!-- 親フォルダ詳細情報表示エリア -->
                    <div class="parent-folder-details" id="parentFolderDetails" style="display: none;">
                        <h5>📁 親フォルダ詳細情報</h5>
                        <div class="folder-details-content">
                            <div class="folder-basic-info">
                                <h6>基本情報</h6>
                                <p><strong>フォルダ名:</strong> <span id="parentFolderName"></span></p>
                                <p><strong>フォルダID:</strong> <span id="parentFolderIdDisplay"></span></p>
                                <p><strong>作成日時:</strong> <span id="parentFolderCreated"></span></p>
                                <p><strong>更新日時:</strong> <span id="parentFolderModified"></span></p>
                            </div>
                            
                            <div class="folder-contents">
                                <h6>フォルダ内容</h6>
                                <div class="contents-summary">
                                    <p>📁 子フォルダ: <span id="subFoldersCount">0</span>個</p>
                                    <p>📄 ファイル: <span id="filesCount">0</span>個</p>
                                </div>
                                
                                <div class="contents-lists">
                                    <div class="sub-folders-list">
                                        <h6>子フォルダ一覧</h6>
                                        <div id="subFoldersList" class="items-list"></div>
                                    </div>
                                    
                                    <div class="files-list">
                                        <h6>ファイル一覧</h6>
                                        <div id="filesListDetails" class="items-list"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- フォルダ一覧表示エリア -->
                    <div class="folder-browser" id="folderBrowser">
                        <h5>フォルダ一覧</h5>
                        <button onclick="displayBoxFolders()">ルートフォルダを表示</button>
                        <div id="folderList" class="folder-list"></div>
                    </div>
                </div>
            </div>

        </main>

        <footer>
            <p>Powered by Google Gemini AI</p>
        </footer>
    </div>

    <script src="script.js"></script>
</body>
</html>
