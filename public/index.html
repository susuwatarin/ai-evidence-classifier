<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI証拠分類ツール</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-content">
                <h1 class="headline-1">🤖 AI証拠分類ツール</h1>
                <p class="body-1">会計資料をAIで自動分類します</p>
            </div>
        </header>

        <main class="main-content">
            <!-- ファイルアップロードエリア -->
            <div class="card card-elevated card-large">
                <h2 class="headline-3">📁 ファイルアップロード</h2>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-content">
                        <div class="upload-icon">📁</div>
                        <div class="upload-text">ファイルをドラッグ&ドロップ</div>
                        <div class="upload-hint">または</div>
                        <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                            ファイルを選択
                        </button>
                        <input type="file" id="fileInput" accept="image/*,.pdf" multiple style="display: none;">
                        <div class="upload-hint">対応形式: PNG, JPG, JPEG, GIF, PDF</div>
                    </div>
                </div>
            </div>

            <!-- 選択されたファイル表示 -->
            <div class="card card-outlined card-medium" id="selectedFiles" style="display: none;">
                <h2 class="headline-3">📋 選択されたファイル</h2>
                <div class="file-list" id="fileList"></div>
                <button class="btn btn-success" id="classifyBtn" onclick="startClassification()">
                    🚀 分類開始
                </button>
            </div>

            <!-- 進捗表示 -->
            <div class="card card-filled card-medium" id="progressArea" style="display: none;">
                <h2 class="headline-3">⏳ 分類中...</h2>
                <div class="progress-area">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">準備中...</div>
                    <div class="progress-stats" id="progressStats" style="display: none;">
                        <div class="stat-item">
                            <div class="stat-label">完了</div>
                            <div class="stat-value" id="completedCount">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">成功</div>
                            <div class="stat-value success" id="successCount">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">エラー</div>
                            <div class="stat-value error" id="errorCount">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 結果表示 -->
            <div class="card card-elevated card-large" id="resultsArea" style="display: none;">
                <h2 class="headline-3">📊 分類結果</h2>
                <div class="results-list" id="resultsList"></div>
                <div class="margin-top-lg" style="display: flex; gap: var(--md-space-md);">
                    <button class="btn btn-primary" id="downloadBtn" onclick="downloadResults()">
                        📊 CSVダウンロード
                    </button>
                    <button class="btn btn-secondary" onclick="resetApp()">
                        🔄 リセット
                    </button>
                </div>
            </div>

            <!-- Box連携セクション -->
            <div class="card card-outlined card-extra-large" id="boxSection">
                <h2 class="headline-3">📦 Box連携</h2>
                <p class="body-1">Boxアカウントと連携して、ファイルを直接Boxから取得・分類できます</p>
                
                <!-- Box認証 -->
                <div class="auth-section">
                    <h4 class="headline-5">Box認証</h4>
                    <div id="authStatus" class="auth-status">
                        <p class="body-1">Boxにログインしてください</p>
                        <button class="btn btn-primary" id="authBtn" onclick="authenticateBox()">
                            🔐 Boxにログイン
                        </button>
                    </div>
                </div>

                <!-- 認証後のフォルダ設定 -->
                <div class="folder-section" id="folderSection" style="display: none;">
                    <h4 class="headline-5">フォルダ設定</h4>
                    <div class="folder-input">
                        <label for="parentFolderInput" class="body-1">親フォルダID/URL:</label>
                        <input type="text" id="parentFolderInput" placeholder="https://box.com/folder/123456789 または 123456789">
                        <button class="btn btn-primary" onclick="setParentFolder()">設定適用</button>
                    </div>
                    
                    <div class="folder-info" id="folderInfo" style="display: none;">
                        <h5>現在の設定:</h5>
                        <p id="currentFolderName"></p>
                        <button class="btn btn-secondary" onclick="checkRequiredFolders()">必須フォルダをチェック</button>
                    </div>
                    
                    <!-- 親フォルダ詳細情報表示エリア -->
                    <div class="parent-folder-details" id="parentFolderDetails" style="display: none;">
                        <h5>📁 親フォルダ詳細情報</h5>
                        <div class="folder-details-content">
                            <div class="folder-basic-info">
                                <h6>基本情報</h6>
                                <p><strong>フォルダ名:</strong> <span id="parentFolderName"></span></p>
                                <p><strong>フォルダID:</strong> <span id="parentFolderIdDisplay"></span></p>
                                <p><strong>作成日時:</strong> <span id="parentFolderCreated"></span></p>
                                <p><strong>更新日時:</strong> <span id="parentFolderModified"></span></p>
                            </div>
                            
                            <div class="folder-contents">
                                <h6>フォルダ内容</h6>
                                <div class="contents-summary">
                                    <p>📁 子フォルダ: <span id="subFoldersCount">0</span>個</p>
                                    <p>📄 ファイル: <span id="filesCount">0</span>個</p>
                                </div>
                                
                                <div class="contents-lists">
                                    <div class="sub-folders-list">
                                        <h6>子フォルダ一覧</h6>
                                        <div id="subFoldersList" class="items-list"></div>
                                    </div>
                                    
                                    <div class="files-list">
                                        <h6>ファイル一覧</h6>
                                        <div id="filesListDetails" class="items-list"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- フォルダ一覧表示エリア -->
                    <div class="folder-browser" id="folderBrowser">
                        <h5>フォルダ一覧</h5>
                        <button class="btn btn-secondary" onclick="displayBoxFolders()">ルートフォルダを表示</button>
                        <div id="folderList" class="folder-list"></div>
                    </div>
                </div>
            </div>

        </main>

        <footer>
            <p>Powered by Google Gemini AI</p>
        </footer>
    </div>

    <script src="script.js"></script>
</body>
</html>
